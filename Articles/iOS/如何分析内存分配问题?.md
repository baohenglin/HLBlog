## 内存分配分析

**OOM**（Out of Memory），指的是 App 占用的内存达到了 iOS 系统对单个 App 占用内存上限后，而被系统强杀掉的现象。这种崩溃，是由 iOS 的 **Jetsam 机制**（系统为了控制内存资源过度使用而采用的一种资源管控机制）导致的一种崩溃，并且无法通过日志捕捉到该崩溃信息。那么临近 OOM，该如何获取详细的内存分配信息，进而分析内存问题呢？

### 通过 JetsamEvent 日志计算内存限制值

可以查看设备中以 JetsamEvent 开头的系统日志。在 设置 -> 隐私 -> 分析，可以看到这些日志。

```
"pageSize" : 4096,
{
    "uuid" : "8e20cd83-0b76-3bf3-b909-563a5ea89d89",
    "states" : [
      "frontmost",
      "resume"
    ],
    "killDelta" : 7350,
    "genCount" : 0,
    "age" : 816388409,
    "purgeable" : 0,
    "fds" : 25,
    "coalition" : 1482,
    "rpages" : 166400,
    "reason" : "per-process-limit",
    "pid" : 6281,
    "cpuTime" : 2.1654900000000001,
    "name" : "MemoryLimitTest",
    "lifetimeMax" : 41686
}
```

* pageSize 字段表明当前内存页的大小为 4096 / 1024 = 4K；
* reason 字段表示进程被 kill的原因是超过进程的内存限制；
* rpages 字段是 resident pages的缩写，表明进程当前占用的内存页数量。

基于上面的 pageSize 与 rpages，可以计算出进程占用的内存大小为：166400 * 4096 / 1024 / 1024 = 650M，也就是说，该设备上处于前台App最大可占用内存上限为 650M。










